<sm-modal title="Perfil" class="fluid profile-modal" icon="home" #profileModal>
  <modal-content>
    <sm-tabs (click)="refresh()">
      <sm-tab title="Datos de Usuario">
        <form class="ui form" [formGroup]="registerForm" name="registerForm">
          <div class="ui left aligned basic segment">
            <div class="form-group field">
              <sm-input
                type="text"
                label="Nombre de Usuario"
                [control]="registerForm.controls.username"
                placeholder="Ingresar nombre de usuario"
              ></sm-input>
              <app-input-error-messages [control]="registerForm.controls.username"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input
                type="password"
                label="Contraseña"
                [control]="registerForm.controls.password"
                placeholder="Ingresar Contraseña"
              ></sm-input>
              <app-input-error-messages [control]="registerForm.controls.password"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input type="text" label="Nombre" [control]="registerForm.controls.name" placeholder="Ingresar Nombre"></sm-input>
              <app-input-error-messages [control]="registerForm.controls.name"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input type="text" label="Apellido" [control]="registerForm.controls.lastname" placeholder="Ingresar Apellido"></sm-input>
              <app-input-error-messages [control]="registerForm.controls.lastname"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input type="email" label="Email" [control]="registerForm.controls.email" placeholder="Ingresar Email"></sm-input>
              <app-input-error-messages [control]="registerForm.controls.email"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input type="text" label="Dirección" [control]="registerForm.controls.address" placeholder="Ingresar dirección"></sm-input>
              <app-input-error-messages [control]="registerForm.controls.address"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input
                type="date"
                label="Fecha de nacimiento"
                [control]="registerForm.controls.birthday"
                placeholder="Ingresar fecha de nacimiento"
              ></sm-input>
              <app-input-error-messages [control]="registerForm.controls.birthday"></app-input-error-messages>
            </div>
            <div class="ui segment">
              <h4 class="ui dividing header">Selecciona los productos a utilizar</h4>
              <div class="four fields">
                <div class="form-group field">
                  <div class="ui toggle checkbox"><sm-checkbox label="Ventas" [control]="registerForm.controls.sales"></sm-checkbox></div>
                </div>
                <div class="form-group field">
                  <div class="ui toggle checkbox"><sm-checkbox label="Stock" [control]="registerForm.controls.stock"></sm-checkbox></div>
                </div>
                <div class="form-group field">
                  <div class="ui toggle checkbox">
                    <sm-checkbox label="Clientes" [control]="registerForm.controls.clients"></sm-checkbox>
                  </div>
                </div>
                <div class="field">
                  <div class="ui toggle checkbox">
                    <sm-checkbox label="Proveedores" [control]="registerForm.controls.providers"></sm-checkbox>
                  </div>
                </div>
              </div>
            </div>

            <div fxLayout="column" fxLayoutGap="15px">
              <div fxLayout="row" fxLayoutGap="15px">
                <button
                  fxFlex="20"
                  fxFlex.xs="100"
                  class="ui button tiny"
                  [disabled]="!registerForm.valid"
                  type="submit"
                  (click)="updateClientInfo(registerForm)"
                >
                  Actualizar Datos
                </button>
              </div>
              <div fxLayout="row" fxLayoutAlign="end center">
                <button fxFlex="20" fxFlex.xs="100" class="ui button tiny" (click)="profileModal.hide()">Cancelar</button>
              </div>
            </div>
          </div>
        </form>
      </sm-tab>
      <sm-tab *ngIf="userData?.profile.isAdmin" title="Datos de Empresa">
        <form class="ui form" [formGroup]="userForm" name="Form">
          <div class="ui horizontal divider">Datos Generales</div>

          <div class="ui left aligned basic segment">
            <div class="form-group field">
              <sm-input type="text" label="Nombre" [control]="userForm.controls.name" placeholder="Ingresar Nombre"> </sm-input>
              <app-input-error-messages [control]="userForm.controls.name"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input
                type="text"
                label="Nombre De Fantasia"
                [control]="userForm.controls.fantasyName"
                placeholder="Ingresar nombre de fantasia"
              >
              </sm-input>
              <app-input-error-messages [control]="userForm.controls.fantasyName"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="email" label="E-mail" [control]="userForm.controls.email" placeholder="Ingresar E-mail"> </sm-input>
              <app-input-error-messages [control]="userForm.controls.email"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="text" label="Localidad" [control]="userForm.controls.place" placeholder="Ingresar Localidad"> </sm-input>
              <app-input-error-messages [control]="userForm.controls.place"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="number" label="Código Postal" [control]="userForm.controls.codigoPostal" placeholder="Ingresar código postal">
              </sm-input>
              <app-input-error-messages [control]="userForm.controls.codigoPostal"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="text" label="Provincia" [control]="userForm.controls.codigoProvincia" placeholder="Ingresar código provincia">
              </sm-input>
              <app-input-error-messages [control]="userForm.controls.codigoProvincia"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="text" label="Dirección" [control]="userForm.controls.address" placeholder="Ingresar Dirección"> </sm-input>
              <app-input-error-messages [control]="userForm.controls.address"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="tel" label="Teléfono" [control]="userForm.controls.telephone" placeholder="Ingresar Teléfono"> </sm-input>
              <app-input-error-messages [control]="userForm.controls.telephone"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="number" label="C.U.I.T (solo números)" [control]="userForm.controls.cuit" placeholder="Ingresar C.U.I.T">
              </sm-input>
              <app-input-error-messages [control]="userForm.controls.cuit"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-select
                class="fluid search inverted"
                label="Tipo de Documento"
                [(model)]="tipoDocumento"
                (onChange)="checkDocumentType($event)"
                placeholder="Seleccione tipo de documento"
              >
                <option *ngFor="let tipo of documentTypes" [value]="tipo.value">{{ tipo.label }}</option>
              </sm-select>
              <app-input-error-messages [control]="userForm.controls.tipoDocumento"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="text" label="Documento" [control]="userForm.controls.documento" placeholder="Ingresar Documento"> </sm-input>
              <app-input-error-messages [control]="userForm.controls.documento"></app-input-error-messages>
            </div>

            <div class="form-group field">
              <sm-input type="text" label="Página Web" [control]="userForm.controls.web" placeholder="Ingresar Página Web"> </sm-input>
              <app-input-error-messages [control]="userForm.controls.web"></app-input-error-messages>
            </div>

            <div class="ui horizontal divider">Tipo de responsabilidad</div>

            <div class="form-group field">
              <div class="ui toggle checkbox">
                <sm-checkbox
                  label="Responsable Inscripto"
                  [control]="userForm.controls.responsableInscripto"
                  (change)="responsableChange(userForm.controls.responsableInscripto)"
                  placeholder="Ingresar responsable inscripto"
                >
                </sm-checkbox>
              </div>
            </div>

            <div class="form-group field">
              <div class="ui toggle checkbox">
                <sm-checkbox
                  label="Exento"
                  [control]="userForm.controls.excento"
                  (change)="responsableChange(userForm.controls.excento)"
                  placeholder="Ingresar si es exento"
                >
                </sm-checkbox>
              </div>
            </div>

            <div class="form-group field">
              <div class="ui toggle checkbox">
                <sm-checkbox
                  label="Responsable Monotributo"
                  [control]="userForm.controls.responsableMonotributo"
                  (change)="responsableChange(userForm.controls.responsableMonotributo)"
                  placeholder="Ingresar si es responsable monotributo"
                >
                </sm-checkbox>
              </div>
            </div>
          </div>

          <modal-actions>
            <div fxLayout="column" fxLayoutGap="15px">
              <div fxLayout="row" fxLayoutGap="15px">
                <button
                  fxFlex="20"
                  fxFlex.xs="100"
                  class="ui button tiny"
                  (click)="updateClientCompany(userForm)"
                  [disabled]="userForm.invalid"
                >
                  Actualizar Datos
                </button>
              </div>
              <div fxLayout="row" fxLayoutAlign="end center">
                <button fxFlex="20" fxFlex.xs="100" class="ui button tiny" (click)="profileModal.hide()">Cancelar</button>
              </div>
            </div>
          </modal-actions>
        </form>
      </sm-tab>
      <sm-tab *ngIf="userData?.profile.isAdmin" title="Nuevo Sub-Usuario">
        <form class="ui form" [formGroup]="newSubUserForm" name="newSubUserForm">
          <div class="ui left aligned basic segment">
            <div class="form-group field">
              <sm-input
                type="text"
                label="Nombre de Usuario"
                [control]="newSubUserForm.controls.username"
                placeholder="Ingresar nombre de usuario"
              ></sm-input>
              <app-input-error-messages [control]="newSubUserForm.controls.username"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input
                type="password"
                label="Contraseña"
                [control]="newSubUserForm.controls.password"
                placeholder="Ingresar Contraseña"
              ></sm-input>
              <app-input-error-messages [control]="newSubUserForm.controls.password"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input type="text" label="Nombre" [control]="newSubUserForm.controls.name" placeholder="Ingresar Nombre"></sm-input>
              <app-input-error-messages [control]="newSubUserForm.controls.name"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input
                type="text"
                label="Apellido"
                [control]="newSubUserForm.controls.lastname"
                placeholder="Ingresar Apellido"
              ></sm-input>
              <app-input-error-messages [control]="newSubUserForm.controls.lastname"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input type="email" label="Email" [control]="newSubUserForm.controls.email" placeholder="Ingresar Email"></sm-input>
              <app-input-error-messages [control]="newSubUserForm.controls.email"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input
                type="text"
                label="Dirección"
                [control]="newSubUserForm.controls.address"
                placeholder="Ingresar dirección"
              ></sm-input>
              <app-input-error-messages [control]="newSubUserForm.controls.address"></app-input-error-messages>
            </div>
            <div class="form-group field">
              <sm-input
                type="date"
                label="Fecha de nacimiento"
                [control]="newSubUserForm.controls.birthday"
                placeholder="Ingresar fecha de nacimiento"
              ></sm-input>
              <app-input-error-messages [control]="newSubUserForm.controls.birthday"></app-input-error-messages>
            </div>
            <div *ngIf="userData?.profile.isAdmin" class="ui segment">
              <h4 class="ui dividing header">Selecciona los productos a utilizar</h4>
              <div class="four fields">
                <div class="form-group field">
                  <div class="ui toggle checkbox"><sm-checkbox label="Ventas" [control]="newSubUserForm.controls.sales"></sm-checkbox></div>
                </div>
                <div class="form-group field">
                  <div class="ui toggle checkbox"><sm-checkbox label="Stock" [control]="newSubUserForm.controls.stock"></sm-checkbox></div>
                </div>
                <div class="form-group field">
                  <div class="ui toggle checkbox">
                    <sm-checkbox label="Clientes" [control]="newSubUserForm.controls.clients"></sm-checkbox>
                  </div>
                </div>
                <div class="field">
                  <div class="ui toggle checkbox">
                    <sm-checkbox label="Proveedores" [control]="newSubUserForm.controls.providers"></sm-checkbox>
                  </div>
                </div>
              </div>
            </div>

            <div fxLayout="column" fxLayoutGap="15px">
              <div fxLayout="row" fxLayoutGap="15px">
                <button
                  fxFlex="20"
                  fxFlex.xs="100"
                  class="ui button tiny"
                  [disabled]="!newSubUserForm.valid"
                  type="submit"
                  (click)="createSubClient(newSubUserForm)"
                >
                  Crear
                </button>
              </div>
              <div fxLayout="row" fxLayoutAlign="end center">
                <button fxFlex="20" fxFlex.xs="100" class="ui button tiny" (click)="profileModal.hide()">Cancelar</button>
              </div>
            </div>
          </div>
        </form>
      </sm-tab>
      <sm-tab *ngIf="userData?.profile.isAdmin" title="Sub-usuarios asociados">
        <table class="ui celled striped inverted table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Apellido</th>
              <th>E-Mail</th>
              <th>Ventas</th>
              <th>Clientes</th>
              <th>Proveedores</th>
              <th>Productos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let internalUser of internalUsers; let i = index">
              <td>{{ internalUser.name }}</td>
              <td>{{ internalUser.lastname }}</td>
              <td>{{ internalUser.email }}</td>

              <ng-container *ngIf="internalUser.sales; else elseSalesTemplate">
                <td><i class="check icon"></i></td>
              </ng-container>
              <ng-template #elseSalesTemplate>
                <td><i class="x icon"></i></td>
              </ng-template>

              <ng-container *ngIf="internalUser.clients; else elseClientsTemplate">
                <td><i class="check icon"></i></td>
              </ng-container>
              <ng-template #elseClientsTemplate>
                <td><i class="x icon"></i></td>
              </ng-template>

              <ng-container *ngIf="internalUser.providers; else elseProvidersTemplate">
                <td><i class="check icon"></i></td>
              </ng-container>
              <ng-template #elseProvidersTemplate>
                <td><i class="x icon"></i></td>
              </ng-template>

              <ng-container *ngIf="internalUser.stock; else elseStockTemplate">
                <td><i class="check icon"></i></td>
              </ng-container>
              <ng-template #elseStockTemplate>
                <td><i class="x icon"></i></td>
              </ng-template>
            </tr>
            <tr colspan="5" *ngIf="internalUsers.length === 0">
              <td>No se han encontrado usuarios internos</td>
            </tr>
          </tbody>
        </table>
      </sm-tab>
    </sm-tabs>
  </modal-content>
</sm-modal>
<modal-actions> <simple-notifications *ngIf="options" [options]="options"></simple-notifications> </modal-actions>
